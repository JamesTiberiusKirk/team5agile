<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta name="description" content="Compare treatment prices and search for providers nearby">
  <meta name="keywords" content="healthcare, search, treatment, hospital, US, health, procedure">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name='robots' content='noindex, nofollow'>
  <meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />
  <title>Compare Treatment Prices</title>
  <script src="https://code.jquery.com/jquery-2.2.4.js" integrity="sha256-iT6Q9iMJYuQiMWNd9lDyBUStIq/8PuOW33aOqmvFpqI=" crossorigin="anonymous">
  </script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" type="text/css">
  <link rel="stylesheet" href="theme.css" type="text/css">
  <link href='https://fonts.googleapis.com/css?family=Source+Sans+Pro:400,700' rel='stylesheet'>
  <script src='https://api.tiles.mapbox.com/mapbox-gl-js/v1.6.1/mapbox-gl.js'></script>
  <link href='https://api.tiles.mapbox.com/mapbox-gl-js/v1.6.1/mapbox-gl.css' rel='stylesheet' />
</head>

<body>
  <!-- Navbar -->
  <nav class="navbar navbar-expand-md fixed-top bg-light navbar-light" style="box-shadow: black 0px 0px 4px, black 0px 0px 4px;">
    <div class="container">
      <button class="navbar-toggler navbar-toggler-right" type="button" data-toggle="collapse" data-target="#navbar2SupportedContent" aria-controls="navbar2SupportedContent" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button>
      <div class="collapse navbar-collapse justify-content-center" id="navbar2SupportedContent">
        <ul class="navbar-nav">
          <li class="nav-item mx-2 text-primary" style="">
            <a class="nav-link text-primary" href="index.html"><b class="text-primary">Home</b></a>
          </li>
          <li class="nav-item mx-2 text-primary" style="">
            <a class="nav-link text-primary" href="info.html">What we do</a>
          </li>
          <li class="nav-item mx-2 text-primary" style="">
            <a class="nav-link text-primary" href="treatments.html">Treatments</a>
          </li>
          <li class="nav-item mx-2 text-primary" style="">
            <a class="nav-link text-primary" href="providers.html">Providers</a>
          </li>
          <li class="nav-item mx-2 text-primary" style="">
            <a class="nav-link text-primary" href="about.html">About</a>
          </li>
        </ul>
        <a class="btn navbar-btn mx-2 btn-outline-success" href="#map">Start search</a><a class="btn navbar-btn mx-2 btn-outline-primary" href="login.html">Log in</a>
      </div>
    </div>
  </nav>
    
  <!-- Hero image section -->
  <div class="py-5 text-center" style="background-image: url('images/hands.jpeg');height: 720px; background-position:center;background-size:auto;" >
    <div class="container">
      <div class="row mt-5">
        <div class="mx-auto col-md-6 col-10 bg-white p-5">
          <h1>Compare treatment prices</h1>
          <p class="mb-3">Wherever you are</p><a class="btn btn-lg shadowed btn-success text-center align-items-center mt-4" href="#map" style="">Start search</a><a href="#map"><i class="d-block fa fa-angle-down text-center fa-3x pt-3"></i></a>
        </div>
      </div>
    </div>
  </div>
    
  <!-- Paragraph section --> 
    <a id="text">
      <div class="pt-4">
        <div class="container">
          <div class="row">
            <div class="col-md-12">
              <div class="py-5 text-center" >
                <div class="container">
                  <div class="row">
                    <div class="mx-auto col-md-8"> <i class="fa fa-4x mx-3 d-inline text-muted fa-search"></i>
                      <h2 class="text-center mt-5 mb-5">Find the right option for you.<br>
                          <small class="text-muted">Search by treatment and your location.</small></h2>
                      <p class="mt-3 lead">Make an informed decision based on thousands of records&nbsp;<br>and choose the best option close to where you are.</p>
                    </div>
                  </div>
                 </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </a>
    
    
    
<!-- Search section --> 
  <div class="py-4" style="">
    <div class="container">
      <div class="row">
        <div class="col-md-12">
          <h5>Search for Procedure: <input type="text" id="place" value=""> <button class="btn navbar-btn mx-2 btn-outline-success" onclick="getProcedures()">Submit</button></h5>


            <div id="container"></div>
            <script>
                
                    
                function insert(prov) {

                  var div = document.getElementById('container');
                  var child_div = document.createElement('div');
                  var pro_name = prov.procedure_Def;
                  var prov_name = prov.provider_Name;
                  var pro_price = prov.avg_Medicare_Payments;
                  child_div.innerHTML = `<p>${prov_name}: ${pro_name}: $${pro_price} </p>`;
                  div.appendChild(child_div)

                }

                function getProcedures() {
                  var url = `https://api.team5agile.dumitruvulpe.com`;
                  var pro_uri = `/procedures/?search_query=`;
                  var procedureName = document.getElementById("place").value;

                  fetch(url+pro_uri+procedureName)
                    .then((res) => {
                      return res.json();
                    })
                    .then((data) => {
                      console.log(data[0])
                      data[0].forEach(e => {
                        insert(e)
                        searchForProviderZip(e.provider_Zip)
                        .then((res)=>{
                          //do smth with res
                          createGeoJSON(res);
                        }).catch((err)=>{
                          //deal with err
                        });
                      });
                    })
                    .catch((error) => {
                      console.log(error)
                    });

                }

                function searchForProviderZip(zip_code) {
                  return new Promise((reject, resolve) => {
                    var url = `https://api.team5agile.dumitruvulpe.com`;
                    var zip_uri = '/zip2coords?zip=';
                    //console.log(zip_code)
                    fetch(url + zip_uri + zip_code)
                      .then((res) => {
                        return res.json();
                      })
                      .then((data) => {
                        // console.log('here')
                        console.log(data[0])
                        // console.log(typeof(data[0]))
                        // data[0].forEach(e => {
                        //   insert(e)
                        // });
                        resolve(data);
                      })
                      .catch((error) => {
                        // console.log(error)
                        reject(error)
                      });
                  });

                  

              }

            const createGeoJSON = (res) => {
                const data = [
                     {
                         lat: document.getElementById(res.zip_Lat).value,
                         lng: document.getElementById(res.zip_Long).value
                     }
                 ];
                data[0][document.getElementById("procedure_ID").value] = document.getElementById(res.procedure_ID).value;
                console.log(e.avg_Medicare_Payments)
                data[0][document.getElementById("procedure_Def").value] = document.getElementById(res.procedure_Def).value;
                data[0][document.getElementById("provider_Name").value] = document.getElementById(res.provider_Name).value;
                data[0][document.getElementById("provider_StreetAdd").value] = document.getElementById(res.provider_StreetAdd).value;
                data[0][document.getElementById("provider_City").value] = document.getElementById(res.provider_City).value;
                data[0][document.getElementById("provider_State").value] = document.getElementById(res.provider_State).value;
                data[0][document.getElementById("provider_Zip").value] = document.getElementById(res.provider_Zip).value;
                data[0][document.getElementById("avg_Covered_Charges").value] = document.getElementById(res.avg_Covered_Charges).value;
                data[0][document.getElementById("avg_Total_Payments").value] = document.getElementById(res.avg_Total_Payments).value;
                data[0][document.getElementById("avg_Medicare_Payments").value] = document.getElementById(res.avg_Medicare_Payments).value;
                data[0][document.getElementById("provider_referral").value] = document.getElementById(res.provider_referral).value;

                const dataGeoJSON = GeoJSON.parse(data, { Point: ["lat", "lng"] });
                document.getElementById("output").value = JSON.stringify(dataGeoJSON, null, 4);
                console.log(dataGeoJSON)
            }
            </script>
        </div>
      </div>
    </div>
  </div>
    
    

    
  <!-- iframe map section -->
    <a id="map">
      <div class="py-5">
        <div class="container">
          <div class="row mt-4 mb-4">
            <div class="col-md-12">
                <iframe src="indexmap.html" scrollable = "no" width="100%" class="myIframe">
                  <p>Your browser does not support iframes.</p>
                </iframe>
                <script type="text/javascript" language="javascript"> 
                    $('.myIframe').css('height', ($(window).height())*0.80+'px');
                </script>
            </div>
          </div>
        </div>
      </div>
    </a>


  <!-- Footer -->
  <div class="py-3">
    <div class="container">
      <div class="row">
        <div class="col-md-6" style="">
          <div class="col-md-12 text-center d-md-flex align-items-center" style="">
            <ul class="nav mx-md-auto d-flex justify-content-center">
              <li class="nav-item"> <a class="nav-link active" href="index.html">Home</a> </li>
              <li class="nav-item"> <a class="nav-link" href="treatments.html">Treatments</a> </li>
              <li class="nav-item"> <a class="nav-link" href="providers.html">Providers</a> </li>
              <li class="nav-item"> <a class="nav-link" href="about.html">About</a> </li>
            </ul>
          </div>
        </div>
        <div class="col-md-6" style="">
          <div class="col-md-6" style="">
          </div>
          <div class="d-flex justify-content-md-between my-2 col-md-5 align-items-center justify-content-center offset-md-4" style=""> <a href="https://en-gb.facebook.com">
              <i class="d-block fa fa-facebook-official text-muted fa-lg mx-2"></i>
            </a> <a href="https://www.instagram.com">
              <i class="d-block fa fa-instagram text-muted fa-lg mx-2"></i>
            </a> <a href="https://twitter.com">
              <i class="d-block fa fa-twitter text-muted fa-lg ml-2"></i>
            </a> </div>
        </div>
      </div>
      <div class="row">
        <div class="col-md-12 text-center">
          <p class="mt-2 mb-0">© 2020 Team5. All rights reserved</p>
        </div>
      </div>
    </div>
  </div>
  <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous" style=""></script>
</body>
</html>